<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Управление производством пазлов</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            margin-top: 20px;
        }
        .card {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Управление производством пазлов</h1>

        <!-- Фанерный лист -->
        <div class="card">
            <div class="card-header bg-primary text-white">
                Фанерный лист
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="plywoodSheetTitle" class="form-label">Название:</label>
                    <input type="text" class="form-control" id="plywoodSheetTitle">
                </div>
                <div class="mb-3">
                    <label for="plywoodSheetMaterial" class="form-label">Материал:</label>
                    <input type="text" class="form-control" id="plywoodSheetMaterial">
                </div>
                <div class="mb-3">
                    <label for="plywoodSheetThickness" class="form-label">Толщина:</label>
                    <input type="number" class="form-control" id="plywoodSheetThickness">
                </div>
                <button class="btn btn-success" onclick="addPlywoodSheet()">Добавить</button>
                <button class="btn btn-info" onclick="showAllPlywoodSheets()">Показать все</button>
                <button class="btn btn-warning" onclick="getPlywoodSheetByName()">Показать по имени</button>
                <button class="btn btn-danger" onclick="deletePlywoodSheet()">Удалить</button>
                <button class="btn btn-secondary" onclick="updatePlywoodSheet()">Обновить</button>

                <div id="plywoodSheetResult"></div>
            </div>
        </div>

        <!-- Пазл -->
        <div class="card">
            <div class="card-header bg-secondary text-white">
                Пазл
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="puzzleTitle" class="form-label">Название:</label>
                    <input type="text" class="form-control" id="puzzleTitle">

                </div>
                <div class="mb-3">
                    <label for="puzzleSheetType" class="form-label">Тип листа:</label>
                    <input type="text" class="form-control" id="puzzleSheetType">
                </div>
                <div class="mb-3">
                    <label for="puzzlePieceCount" class="form-label">Количество деталей:</label>
                    <input type="number" class="form-control" id="puzzlePieceCount">
                </div>
                <div class="mb-3">
                    <label for="puzzlePrice" class="form-label">Цена:</label>
                    <input type="number" class="form-control" id="puzzlePrice">
                </div>
                <button class="btn btn-success" onclick="addPuzzle()">Добавить</button>
                <button class="btn btn-info" onclick="showAllPuzzles()">Показать все</button>
                <button class="btn btn-warning" onclick="getPuzzleByName()">Показать по имени</button>
                <button class="btn btn-danger" onclick="deletePuzzle()">Удалить</button>
                 <button class="btn btn-secondary" onclick="updatePuzzle()">Обновить</button>

                <div id="puzzleResult"></div>
            </div>
        </div>

        <!-- Прайс-лист -->
        <div class="card">
            <div class="card-header bg-success text-white">
                Прайс-лист
            </div>
            <div class="card-body">
                <button class="btn btn-primary" onclick="getPriceList()">Получить прайс-лист</button>
                <div id="priceListResult"></div>
            </div>
        </div>

         <!-- Заказ -->
        <div class="card">
            <div class="card-header bg-warning text-dark">
                Заказ
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="orderStatus" class="form-label">Статус:</label>
                    <input type="text" class="form-control" id="orderStatus">
                </div>
                 <div class="mb-3">
                    <label for="orderRegistrationDate" class="form-label">Дата регистрации:</label>
                    <input type="datetime-local" class="form-control" id="orderRegistrationDate">
                </div>
                <div class="mb-3">
                    <label for="orderClient" class="form-label">Клиент:</label>
                    <input type="text" class="form-control" id="orderClient">
                </div>
                 <div class="mb-3">
                    <label for="orderCompletionDate" class="form-label">Дата завершения:</label>
                    <input type="datetime-local" class="form-control" id="orderCompletionDate">
                </div>
                 <div class="mb-3">
                    <label for="orderItems" class="form-label">Позиции заказа (JSON):</label>
                    <textarea class="form-control" id="orderItems" rows="3"></textarea>
                </div>

                <button class="btn btn-success" onclick="addOrder()">Добавить заказ</button>
                <button class="btn btn-info" onclick="getAllOrders()">Показать все заказы</button>
                <button class="btn btn-warning" onclick="getOrderById()">Показать заказ по ID</button>
                <button class="btn btn-danger" onclick="deleteOrder()">Удалить заказ</button>
                <button class="btn btn-secondary" onclick="updateOrder()">Обновить заказ</button>

                <div id="orderResult"></div>
            </div>
        </div>

        <!-- Техническое задание -->
        <div class="card">
            <div class="card-header bg-info text-white">
                Техническое задание
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="taskId" class="form-label">ID Задания:</label>
                    <input type="number" class="form-control" id="taskId">
                </div>
                <div class="mb-3">
                    <label for="taskStatus" class="form-label">Статус:</label>
                    <input type="text" class="form-control" id="taskStatus">
                </div>
                <div class="mb-3">
                    <label for="taskRegistrationDate" class="form-label">Дата регистрации:</label>
                    <input type="datetime-local" class="form-control" id="taskRegistrationDate">
                </div>
                <div class="mb-3">
                    <label for="taskCompletionDate" class="form-label">Дата завершения:</label>
                    <input type="datetime-local" class="form-control" id="taskCompletionDate">
                </div>
                <div class="mb-3">
                    <label for="taskOrderId" class="form-label">ID Заказа:</label>
                    <input type="number" class="form-control" id="taskOrderId">
                </div>
                <div class="mb-3">
                    <label for="taskItems" class="form-label">Позиции задания (JSON):</label>
                    <textarea class="form-control" id="taskItems" rows="3"></textarea>
                </div>
                <button class="btn btn-success" onclick="createTaskFromOrder()">Создать из заказа</button>
                <button class="btn btn-info" onclick="getAllTasks()">Показать все задачи</button>
                <button class="btn btn-warning" onclick="getTaskById()">Показать задачу по ID</button>
                <button class="btn btn-danger" onclick="deleteTask()">Удалить задачу</button>
                <button class="btn btn-secondary" onclick="updateTask()">Обновить задачу</button>
                <div id="taskResult"></div>
            </div>
        </div>

        <!-- Отчетность -->
        <div class="card">
            <div class="card-header bg-dark text-white">
                Отчетность
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="startDate" class="form-label">Начальная дата:</label>
                    <input type="date" class="form-control" id="startDate">
                </div>
                <div class="mb-3">
                    <label for="endDate" class="form-label">Конечная дата:</label>
                    <input type="date" class="form-control" id="endDate">
                </div>
                <div class="mb-3">
                    <label for="productName" class="form-label">Название продукта:</label>
                    <input type="text" class="form-control" id="productName">
                </div>
                <button class="btn btn-primary" onclick="getSalesReport()">Получить отчет о продажах</button>
                <div id="salesReportResult"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>

        const API_BASE_URL = '/api';

        // Фанерный лист
        async function addPlywoodSheet() {
            const title = document.getElementById('plywoodSheetTitle').value;
            const material = document.getElementById('plywoodSheetMaterial').value;
            const thickness = document.getElementById('plywoodSheetThickness').value;

            const data = { title: title, material: material, thickness: parseInt(thickness) };

            try {
                const response = await fetch(`${API_BASE_URL}/puzzle/sheet/add`, {method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                document.getElementById('plywoodSheetResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('plywoodSheetResult').innerText = 'Ошибка при добавлении.';
            }
        }

        async function showAllPlywoodSheets() {
            try {
                const response = await fetch(`${API_BASE_URL}/puzzle/sheet/show`);
                const result = await response.json();
                document.getElementById('plywoodSheetResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('plywoodSheetResult').innerText = 'Ошибка при получении данных.';
            }
        }

        async function getPlywoodSheetByName() {
            const title = document.getElementById('plywoodSheetTitle').value;
            try {
                const response = await fetch(`${API_BASE_URL}/puzzle/sheet/show/${title}`);
                const result = await response.json();
                document.getElementById('plywoodSheetResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('plywoodSheetResult').innerText = 'Ошибка при получении данных.';
            }
        }

        async function deletePlywoodSheet() {
            const title = document.getElementById('plywoodSheetTitle').value;
            try {
                const response = await fetch(`${API_BASE_URL}/puzzle/sheet/del?title=${title}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                document.getElementById('plywoodSheetResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('plywoodSheetResult').innerText = 'Ошибка при удалении.';
            }
        }

        async function updatePlywoodSheet() {
           const title = document.getElementById('plywoodSheetTitle').value;
            const material = document.getElementById('plywoodSheetMaterial').value;
            const thickness = document.getElementById('plywoodSheetThickness').value;

            const data = { title: title, material: material, thickness: parseInt(thickness) };
            try {
                const response = await fetch(`${API_BASE_URL}/puzzle/sheet/update`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                document.getElementById('plywoodSheetResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('plywoodSheetResult').innerText = 'Ошибка при обновлении.';
            }
        }
        // Пазл
        async function addPuzzle() {
            const title = document.getElementById('puzzleTitle').value;
            const sheetType = document.getElementById('puzzleSheetType').value;
            const pieceCount = document.getElementById('puzzlePieceCount').value;
            const price = document.getElementById('puzzlePrice').value;

            const data = { title: title, sheetType: sheetType, pieceCount: parseInt(pieceCount), price: parseFloat(price) };

            try {
                const response = await fetch(`${API_BASE_URL}/puzzle/add`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                document.getElementById('puzzleResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('puzzleResult').innerText = 'Ошибка при добавлении.';
            }
        }

        async function showAllPuzzles() {
            try {
                const response = await fetch(`${API_BASE_URL}/puzzle/show`);
                const result = await response.json();
                document.getElementById('puzzleResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('puzzleResult').innerText = 'Ошибка при получении данных.';
            }
        }

        async function getPuzzleByName() {
            const title = document.getElementById('puzzleTitle').value;
            try {
                const response = await fetch(`${API_BASE_URL}/puzzle/show/${title}`);
                const result = await response.json();
                document.getElementById('puzzleResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('puzzleResult').innerText = 'Ошибка при получении данных.';
            }
        }

        async function deletePuzzle() {
            const title = document.getElementById('puzzleTitle').value;
            try {
                const response = await fetch(`${API_BASE_URL}/puzzle/delete/${title}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                document.getElementById('puzzleResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('puzzleResult').innerText = 'Ошибка при удалении.';
            }
        }

        async function updatePuzzle() {
           const title = document.getElementById('puzzleTitle').value;
            const sheetType = document.getElementById('puzzleSheetType').value;
            const pieceCount = document.getElementById('puzzlePieceCount').value;
            const price = document.getElementById('puzzlePrice').value;

            const data = { title: title, sheetType: sheetType, pieceCount: parseInt(pieceCount), price: parseFloat(price) };

            try {
                const response = await fetch(`${API_BASE_URL}/puzzle/update`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                document.getElementById('puzzleResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('puzzleResult').innerText = 'Ошибка при обновлении.';
            }
        }

        // Прайс-лист
        async function getPriceList() {
            try {
                const response = await fetch(`${API_BASE_URL}/puzzle/price-list`);
                const result = await response.json();
                document.getElementById('priceListResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('priceListResult').innerText = 'Ошибка при получении прайс-листа.';
            }
        }

        // Заказ
        async function addOrder() {
             const status = document.getElementById('orderStatus').value;
            const registrationDate = document.getElementById('orderRegistrationDate').value;
            const client = document.getElementById('orderClient').value;
            const completionDate = document.getElementById('orderCompletionDate').value;
            const itemsJson = document.getElementById('orderItems').value;

            // Преобразуем JSON-строку в массив объектов
            let items = [];
            try {
                items = JSON.parse(itemsJson);
            } catch (e) {
                alert("Ошибка в формате JSON для позиций заказа: " + e.message);
                return;
            }

             const data = {
                status: status,
                registrationDate: registrationDate,
                client: client,
                completionDate: completionDate ? completionDate : null,
                items: items
            };

            try {
                const response = await fetch(`${API_BASE_URL}/order/add`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                document.getElementById('orderResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('orderResult').innerText = 'Ошибка при добавлении заказа.';
            }
        }

        async function getAllOrders() {
            try {
                const response = await fetch(`${API_BASE_URL}/order/show`);
                const result = await response.json();
                document.getElementById('orderResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('orderResult').innerText = 'Ошибка при получении данных.';
            }
        }

        async function getOrderById() {
            const id = prompt("Введите ID заказа:");
            if (!id) return;
            try {
                const response = await fetch(`${API_BASE_URL}/order/show/${id}`);
                const result = await response.json();
                document.getElementById('orderResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('orderResult').innerText = 'Ошибка при получении данных.';
            }
        }

        async function deleteOrder() {
            const id = prompt("Введите ID заказа для удаления:");
            if (!id) return;
            try {
                const response = await fetch(`${API_BASE_URL}/order/delete/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                document.getElementById('orderResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('orderResult').innerText = 'Ошибка при удалении.';
            }
        }

        async function updateOrder() {
            const id = prompt("Введите ID заказа для обновления:");
            const status = document.getElementById('orderStatus').value;
            const registrationDate = document.getElementById('orderRegistrationDate').value;
            const client = document.getElementById('orderClient').value;
            const completionDate = document.getElementById('orderCompletionDate').value;
            const itemsJson = document.getElementById('orderItems').value;

            // Преобразуем JSON-строку в массив объектов
            let items = [];
            try {
                items = JSON.parse(itemsJson);
            } catch (e) {
                alert("Ошибка в формате JSON для позиций заказа: " + e.message);
                return;
            }

             const data = {
                id:id,
                status: status,
                registrationDate: registrationDate,
                client: client,
                completionDate: completionDate ? completionDate : null,
                items: items
            };

            try {
                const response = await fetch(`${API_BASE_URL}/order/update`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                document.getElementById('orderResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('orderResult').innerText = 'Ошибка при добавлении заказа.';
            }
        }

        // Техническое задание
        async function createTaskFromOrder() {
            const orderId = document.getElementById('taskOrderId').value;
            try {
                const response = await fetch(`${API_BASE_URL}/production-task/create-from-order/${orderId}`, {
                    method: 'POST'
                });
                const result = await response.json();
                document.getElementById('taskResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('taskResult').innerText = 'Ошибка при создании задачи.';
            }
        }

        async function getAllTasks() {
            try {
                const response = await fetch(`${API_BASE_URL}/production-task/show`);
                const result = await response.json();
                document.getElementById('taskResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('taskResult').innerText = 'Ошибка при получении данных.';
            }
        }

        async function getTaskById() {
            const id = document.getElementById('taskId').value;
            try {
                const response = await fetch(`${API_BASE_URL}/production-task/show/${id}`);
                const result = await response.json();
                document.getElementById('taskResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('taskResult').innerText = 'Ошибка при получении данных.';
            }
        }

        async function deleteTask() {
            const id = document.getElementById('taskId').value;
            try {
                const response = await fetch(`${API_BASE_URL}/production-task/delete/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                document.getElementById('taskResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('taskResult').innerText = 'Ошибка при удалении.';
}
        }

        async function updateTask() {
             const id = document.getElementById('taskId').value;
            const status = document.getElementById('taskStatus').value;
            const registrationDate = document.getElementById('taskRegistrationDate').value;
            const completionDate = document.getElementById('taskCompletionDate').value;
            const orderId = document.getElementById('taskOrderId').value;
            const itemsJson = document.getElementById('taskItems').value;

            // Преобразуем JSON-строку в массив объектов
            let items = [];
            try {
                items = JSON.parse(itemsJson);
            } catch (e) {
                alert("Ошибка в формате JSON для позиций заказа: " + e.message);
                return;
            }

             const data = {
                id:id,
                status: status,
                registrationDate: registrationDate,
                completionDate: completionDate ? completionDate : null,
                orderId:orderId,
                items: items
            };

            try {
                const response = await fetch(`${API_BASE_URL}/production-task/update`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                document.getElementById('taskResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('taskResult').innerText = 'Ошибка при добавлении заказа.';
            }
        }

        // Отчет о продажах
        async function getSalesReport() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const productName = document.getElementById('productName').value;

            let url = `${API_BASE_URL}/sales-report?startDate=${startDate}&endDate=${endDate}`;
            if (productName) {
                url += `&productName=${productName}`;
            }

            try {
                const response = await fetch(url);
                const result = await response.json();
                document.getElementById('salesReportResult').innerText = JSON.stringify(result);
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('salesReportResult').innerText = 'Ошибка при получении отчета.';
            }
        }
    </script>
</body>
</html>